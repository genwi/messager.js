/*! Messager.js - v0.1.0 - 2013-03-14
* https://github.com/darius/Messager.js
* Copyright (c) 2013 radius; Licensed MIT */
var Messager=function(){"use strict";var e,t,n,o="$messaging",r=(new Date).getTime(),a=0;try{"localStorage"in window&&null!==window.localStorage&&"JSON"in window&&(n=!0)}catch(i){}n||alert("Your browser doesn't support everything needed for this demo.");var s=function(t){e=t},w=function(e){"string"==typeof e&&(e=JSON.parse(e));var n={window:t=r,serial:++a,state:e};window.localStorage.setItem(o,JSON.stringify(n))},l=function(){var e,n=window.localStorage.getItem(o);if(n){var r=JSON.parse(n);t=r.window,a=r.serial,e=r.state}return e};return window.addEventListener("storage",function(n){if(n.key===o&&n.newValue){var r=JSON.parse(n.newValue);console.log(r),(r.window!==t||r.serial!==a)&&(t=r.window,a=r.serial,e&&(console.log("in storage",r.state),e(r.state)))}},!1),{subscribe:s,publish:w,getState:l}}();